predictors <- 1:(ncol(train.hex)-1)
response <- ncol(train.hex)
model <- h2o.deeplearning(x=predictors,
y=response,
data=train.hex,
classification=T,
activation="RectifierWithDropout",
hidden=c(256,128,64),
hidden_dropout_ratio=c(0.5,0.5,0.5),
input_dropout_ratio=0.05,
epochs=50,
l1=1e-5,
l2=1e-5,
rho=0.99,
epsilon=1e-8,
train_samples_per_iteration=2000,
max_w2=10,
seed=1,
reproducible=T)
model;
}
model<-getDeepModel(cbind(x1AsMatrix,y1))
h2oPrediction<-as.data.frame(h2o.predict(model,as.h2o(localH2O,x2AsMatrix)))
print(paste("h2o auc:",auc(y2,h2oPrediction[,3])));
getDeepModel <- function(train){
train.hex <- as.h2o(localH2O,train)
predictors <- 1:(ncol(train.hex)-1)
response <- ncol(train.hex)
model <- h2o.deeplearning(x=predictors,
y=response,
data=train.hex,
classification=T,
activation="RectifierWithDropout",
hidden=c(32,16,8),
hidden_dropout_ratio=c(0.5,0.5,0.5),
input_dropout_ratio=0.05,
epochs=50,
l1=1e-5,
l2=1e-5,
rho=0.99,
epsilon=1e-8,
train_samples_per_iteration=2000,
max_w2=10,
seed=1,
reproducible=T)
model;
}
print(paste("xg auc:",auc(y2,xgPrediction)));
print(paste("h2o auc:",auc(y2,h2oPrediction[,3])));
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
xg = xgboost(param=param, data = x1AsMatrix, label = y1, nrounds=nrounds)
model<-getDeepModel(cbind(x1AsMatrix,y1))
h2oPrediction<-as.data.frame(h2o.predict(model,as.h2o(localH2O,x2AsMatrix)))
xgPrediction<-predict(xg,x2AsMatrix);
## check for a reasonable AUC of the model against unseen data (2011)
print(paste("xg auc:",auc(y2,xgPrediction)));
print(paste("h2o auc:",auc(y2,h2oPrediction[,3])));
avgPrediction<-(0.5*h2oPrediction[,3]+0.5*xgPrediction);
print(paste("avg auc:",auc(y2,avgPrediction)))
getDeepModel
## now fit a new model to all the data, so that our final submission includes information learned from 2011 as well
xg.cv = xgb.cv(param=param, data = xAsMatrix, label = y,
nfold = 5, nrounds=nrounds)
xg = xgboost(param=param, data = xAsMatrix, label = y, nrounds=nrounds)
model<-getDeepModel(cbind(xAsMatrix,y))
h2oPrediction<-as.data.frame(h2o.predict(model,as.h2o(localH2O,cbind(testAsMatrix))))
xgPrediction<-predict(xg,testAsMatrix);
pSubmit<-(0.5*h2oPrediction[,3]+0.5*xgPrediction);
View(pSubmit)
View(xgPrediction)
View(cbind(h2oPrediction[,3],xgPrediction,pSubmit))
param <- list("objective" = "binary:logitraw",
"eval_metric" = "auc",
"eta" = 0.1,
"max_depth"=3,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
xg = xgboost(param=param, data = x1AsMatrix, label = y1, nrounds=nrounds)
xgPrediction<-predict(xg,x2AsMatrix);
print(paste("xg auc:",auc(y2,xgPrediction)));
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.1,
"max_depth"=3,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.01,
"max_depth"=3,
"nthread" = 2)
nrounds<-240
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.01,
"max_depth"=3,
"nthread" = 2)
nrounds<-1000
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.01,
"max_depth"=3,
"nthread" = 2)
nrounds<-2000
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.01,
"max_depth"=3,
"nthread" = 2)
nrounds<-10000
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.01,
"max_depth"=6,
"nthread" = 2)
nrounds<-10000
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.005,
"max_depth"=6,
"nthread" = 2)
nrounds<-10000
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=6,
"nthread" = 2)
nrounds<-10000
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-10000
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.1,
"max_depth"=3,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.2,
"max_depth"=3,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.25,
"max_depth"=3,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.30,
"max_depth"=3,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.25,
"max_depth"=3,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.25,
"max_depth"=6,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.25,
"max_depth"=4,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.25,
"max_depth"=2,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.25,
"max_depth"=3,
"nthread" = 2)
nrounds<-140
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
View(y1)
# Set necessary parameter
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.25,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
xg = xgboost(param=param, data = x1AsMatrix, label = y1, nrounds=nrounds)
model<-getDeepModel(cbind(x1AsMatrix,y1))
h2oPrediction<-as.data.frame(h2o.predict(model,as.h2o(localH2O,x2AsMatrix)))
xgPrediction<-predict(xg,x2AsMatrix);
## check for a reasonable AUC of the model against unseen data (2011)
print(paste("xg auc:",auc(y2,xgPrediction)));
print(paste("h2o auc:",auc(y2,h2oPrediction[,3])));
avgPrediction<-(0.5*h2oPrediction[,3]+0.5*xgPrediction);
View(cbind(xgPrediction,h2oPrediction[0,3],y2))
View(cbind(xgPrediction,h2oPrediction[,3],y2))
print(paste("h2o auc:",auc(y2,h2oPrediction[,3]/3)));
avgPrediction<-(0.25*h2oPrediction[,3]+0.75*xgPrediction);
print(paste("avg auc:",auc(y2,avgPrediction)))
avgPrediction<-(0.5*h2oPrediction[,3]+0.5*xgPrediction);
print(paste("avg auc:",auc(y2,avgPrediction)))
model<-getDeepModel(cbind(xAsMatrix,y))
h2oPrediction<-as.data.frame(h2o.predict(model,as.h2o(localH2O,cbind(testAsMatrix))))
model<-getDeepModel(cbind(sqrt(xAsMatrix)+3/8,y))
sqrt(xAsMatrix)
View(sqrt(xAsMatrix))
View(xAsMatrix)
View(test)
library(Metrics)
library(xgboost)
library(data.table)
root_dir<-"~/git/RScripts/WestNile/"
submissionDir<-paste0(root_dir,"submission.csv")
source("~/git/RScripts/WestNile/loadWestNileData.R")
model<-getDeepModel(cbind(xAsMatrix,y))
h2oPrediction<-as.data.frame(h2o.predict(model,as.h2o(localH2O,cbind(testAsMatrix))))
library(h2o)
localH2O <- h2o.init(ip = "localhost", port=54321, nthreads = 1)
extractFeature<-function(layerNumber,model,train){
train.hex <- as.h2o(localH2O,train)
deepfeatures_layer = h2o.deepfeatures(train.hex, model, layer = layerNumber)
deepfeatures_layer<-as.data.frame(deepfeatures_layer);
deepfeatures_layer<-as.matrix(deepfeatures_layer);
deepfeatures_layer<-matrix(as.numeric(deepfeatures_layer),nrow(deepfeatures_layer),ncol(deepfeatures_layer))
deepfeatures_layer;
}
getDeepModel <- function(train){
train.hex <- as.h2o(localH2O,train)
predictors <- 1:(ncol(train.hex)-1)
response <- ncol(train.hex)
model <- h2o.deeplearning(x=predictors,
y=response,
data=train.hex,
classification=T,
activation="RectifierWithDropout",
hidden=c(32,16,8),
hidden_dropout_ratio=c(0.5,0.5,0.5),
input_dropout_ratio=0.05,
epochs=50,
l1=1e-5,
l2=1e-5,
rho=0.99,
epsilon=1e-8,
train_samples_per_iteration=2000,
max_w2=10,
seed=1,
reproducible=T)
model;
}
getPrediction<-function(model,test){
for(i in 1:ncol(test)){
test[,i] <- as.numeric(test[,i])
#   test[,i] <- sqrt(test[,i]+(3/8))
}
test.hex <- as.h2o(localH2O,test[,1:ncol(test)])
prediction<-as.data.frame(h2o.predict(model,test.hex))[,2:10]
}
model<-getDeepModel(cbind(xAsMatrix,y))
h2oPrediction<-as.data.frame(h2o.predict(model,as.h2o(localH2O,cbind(testAsMatrix))))
pSubmit<-h2oPrediction[,3];
submissionFile<-cbind(test$Id,pSubmit)
colnames(submissionFile)<-c("Id","WnvPresent")
options("scipen"=100, "digits"=8)
write.csv(submissionFile,submissionDir,row.names=FALSE,quote=FALSE)
submissionDir
View(pSubmit)
xg.cv = xgb.cv(param=param, data = xAsMatrix, label = y,
nfold = 5, nrounds=nrounds)
xg = xgboost(param=param, data = xAsMatrix, label = y, nrounds=nrounds)
xgPrediction<-predict(xg,testAsMatrix);
pSubmit<-xgPrediction;
summary(pSubmit)
submissionFile<-cbind(test$Id,pSubmit)
colnames(submissionFile)<-c("Id","WnvPresent")
options("scipen"=100, "digits"=8)
write.csv(submissionFile,submissionDir,row.names=FALSE,quote=FALSE)
View(pSubmit)
param
View(my.x)
View(test)
testAsMatrix = data.frame(test[,props])
View(testAsMatrix)
testAsMatrix = data.frame(test[,list(dWeek, Species, Latitude, Longitude)])
View(testAsMatrix)
View(test)
source('~/git/RScripts/WestNile/WestNileMain.R', echo=TRUE)
View(test)
View(testAsMatrix)
View(my.x)
x[,dMonth:=as.numeric(as.factor(paste(substr(x$Date,6,7))))]
source('~/git/RScripts/WestNile/WestNileMain.R', echo=TRUE)
test[,dMonth:=as.numeric(as.factor(paste(substr(test$Date,6,7))))]
source('~/git/RScripts/WestNile/WestNileMain.R', echo=TRUE)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-100
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.15,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.15,
"max_depth"=3,
"nthread" = 2)
nrounds<-100
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.15,
"max_depth"=3,
"nthread" = 2)
nrounds<-200
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-60
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
# Set necessary parameter
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.25,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
# Set necessary parameter
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=4,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=5,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
library(Metrics)
library(xgboost)
library(data.table)
root_dir<-"~/git/RScripts/WestNile/"
submissionDir<-paste0(root_dir,"submission.csv")
source("~/git/RScripts/WestNile/loadWestNileData.R")
# Set necessary parameter
param <- list("objective" = "binary:logistic",
"eval_metric" = "auc",
"eta" = 0.20,
"max_depth"=3,
"nthread" = 2)
nrounds<-65
xg.cv = xgb.cv(param=param, data = x1AsMatrix, label = y1,
nfold = 5, nrounds=nrounds)
xg = xgboost(param=param, data = x1AsMatrix, label = y1, nrounds=nrounds)
# model<-getDeepModel(cbind(x1AsMatrix,y1))
# h2oPrediction<-as.data.frame(h2o.predict(model,as.h2o(localH2O,x2AsMatrix)))
xgPrediction<-predict(xg,x2AsMatrix);
## check for a reasonable AUC of the model against unseen data (2011)
print(paste("xg auc:",auc(y2,xgPrediction)));
## now fit a new model to all the data, so that our final submission includes information learned from 2011 as well
xg.cv = xgb.cv(param=param, data = xAsMatrix, label = y,
nfold = 5, nrounds=nrounds)
xg = xgboost(param=param, data = xAsMatrix, label = y, nrounds=nrounds)
xgPrediction<-predict(xg,testAsMatrix);
pSubmit<-xgPrediction;
## look at the predicted distribution (AUC doesn't care about probabilities; just ordering. It's still a good diagnostic)
summary(pSubmit)
submissionFile<-cbind(test$Id,pSubmit)
colnames(submissionFile)<-c("Id","WnvPresent")
options("scipen"=100, "digits"=8)
write.csv(submissionFile,submissionDir,row.names=FALSE,quote=FALSE)
lasagneSubmissionDir<-paste0(root_dir,"lasagne_west_nile.csv")
lasagneSubmission<-read.csv(lasagneSubmissionDir)
submissionFile[,2]<-(pSubmit+lasagneSubmission)/2
submissionFile[,2]<-(pSubmit+lasagneSubmission[,2])/2
write.csv(submissionFile,submissionDir,row.names=FALSE,quote=FALSE)
